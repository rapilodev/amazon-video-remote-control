#!/usr/bin/perl
use warnings;
use strict;
use utf8;

{
    package AmazonRemoteControlServer;

    # put your keyboard input here
    my $device = '/dev/input/event4';

    use HTTP::Server::Simple::CGI;
    use base qw(HTTP::Server::Simple::CGI);

    sub handle_request {
        my $self = shift;
        my $cgi  = shift;

        print "HTTP/1.0 200 OK\r\n";
        return unless ref $cgi;

        print q!Content-type:text/html;charset:utf-8;

<html>
<meta name="viewport" content="initial-scale=1, maximum-scale=1">
<style>
    html,body{
        background:#001;
    }
    .centered {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    table{
        width:72vw;
        height:72vw;
    }
    td{
        width:24vw;
        height:24vw;
    }
    button:hover{
        background:#11f;
        border:        0.5vw solid #0000ff;
        border-bottom: 0.5vw solid #000066;
        border-right:  0.5vw solid #000066;
    }
    button{
        margin:1vw;
        width:70%;
        height:70%;
        font-size:3vw;
        cursor:pointer;
        background:#00f;
        color:white;
        border-radius:3vw;
        border: 0.5vw solid #000066;
        border-bottom: 0.5vw solid #000033;
        border-right:  0.5vw solid #000033;
        transition: all 1s;
    }
</style>
<script>
    function call(key){
        fetch('/?key='+key);
        window.navigator.vibrate(200);
    }
</script>
<body>
<div class="centered">
    <table>
    <tr>
        <td></td>
        <td><button onclick="call('UP')">Vol. +</button></td>
        <td></td>
    </tr>
    <tr>
        <td><button onclick="call('LEFT')">&lt;&lt;</button></td>
        <td><button onclick="call('SPACE')">&#x25b6; / ||</button></td>
        <td><button onclick="call('RIGHT')">&gt;&gt;</button></td>
    </tr>
    <tr>
        <td></td>
        <td><button onclick="call('DOWN')">Vol. -</button></td>
        <td></td>
    </tr>
</div>
</body>
</html>
!;

        if ( my $key = $cgi->param('key') ) {
            next unless $key=~/^(LEFT|RIGHT|UP|DOWN|SPACE)$/;
            system qq{evemu-event $device --type EV_KEY --code KEY_$key --value 1 --sync};
            system qq{evemu-event $device --type EV_KEY --code KEY_$key --value 0 --sync};
        }
    }
}

AmazonRemoteControlServer->new(8080)->run();
